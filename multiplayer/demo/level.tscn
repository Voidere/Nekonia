[gd_scene load_steps=8 format=4 uid="uid://dgq14nic0u2eg"]

[ext_resource type="PackedScene" uid="uid://cd4xuxqi1qlty" path="res://multiplayer/demo/player.tscn" id="1_64v6c"]
[ext_resource type="Texture2D" uid="uid://bbw3l7ns3qacb" path="res://assets/MountainDuskGodot/MountainsLayers/far-clouds.png" id="2_tr2dq"]
[ext_resource type="Texture2D" uid="uid://bcnsdxg457gf4" path="res://assets/MountainDuskGodot/MountainsLayers/far-mountains.png" id="3_ombfp"]
[ext_resource type="Texture2D" uid="uid://dwrfvfjdv5jpt" path="res://localmultiplayer/tileset.png" id="4_tsv1l"]

[sub_resource type="GDScript" id="GDScript_y5sv8"]
script/source = "extends Node

@export var player_scene: PackedScene

func _ready():
	# Only spawn players if we're in multiplayer
	if multiplayer.is_server():
		# Spawn the host player
		spawn_player(1)
	
	# When a new peer connects, spawn their player
	multiplayer.peer_connected.connect(_on_peer_connected)
	multiplayer.peer_disconnected.connect(_on_peer_disconnected)

func _on_peer_connected(id: int):
	# Spawn the new player for all clients
	spawn_player.rpc(id)

func _on_peer_disconnected(id: int):
	# Remove the disconnected player
	if has_node(str(id)):
		get_node(str(id)).queue_free()

@rpc(\"any_peer\", \"call_local\")
func spawn_player(id: int):
	var player = player_scene.instantiate()
	player.name = str(id)
	add_child(player, true)
	
	# Set the player's position based on their ID
	player.position = Vector2(100 + (id * 50), 100)
"

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_wwohc"]
texture = ExtResource("4_tsv1l")
texture_region_size = Vector2i(8, 8)
0:0/0 = 0
0:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-4, -4, 4, -4, 4, 4, -4, 4)
1:0/0 = 0

[sub_resource type="TileSet" id="TileSet_66pxm"]
tile_size = Vector2i(8, 8)
physics_layer_0/collision_layer = 1
sources/0 = SubResource("TileSetAtlasSource_wwohc")

[node name="level" type="Node"]
script = SubResource("GDScript_y5sv8")
player_scene = ExtResource("1_64v6c")

[node name="Far-clouds" type="Sprite2D" parent="."]
position = Vector2(142, 24)
scale = Vector2(5.55469, 1.55)
texture = ExtResource("2_tr2dq")

[node name="Far-mountains" type="Sprite2D" parent="."]
position = Vector2(156, 25)
scale = Vector2(3.61875, 1.34167)
texture = ExtResource("3_ombfp")

[node name="TileMapLayer" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAAAAAgAAAAAAAAAAAABAAgAAAAAAAAAAAACAAgAAAAAAAAAAAADAAgAAAAAAAAAAAAEAAgAAAAAAAAAAAAFAAgAAAAAAAAAAAAGAAgAAAAAAAAAAAAAAAkAAAAAAAAAAAACAAkAAAAAAAAAAAADAAkAAAAAAAAAAAAEAAkAAAAAAAAAAAAFAAkAAAAAAAAAAAAGAAkAAAAAAAAAAAAJAAgAAAAAAAAAAAAJAAcAAAAAAAAAAAAJAAYAAAAAAAAAAAAKAAYAAAAAAAAAAAALAAYAAAAAAAAAAAALAAcAAAAAAAAAAAALAAgAAAAAAAAAAAAKAAgAAAAAAAAAAAAKAAcAAAAAAAAAAAAPAAQAAAAAAAAAAAAQAAUAAAAAAAAAAAAQAAQAAAAAAAAAAAARAAQAAAAAAAAAAAARAAUAAAAAAAAAAAASAAUAAAAAAAAAAAASAAQAAAAAAAAAAAATAAQAAAAAAAAAAAAZAAUAAAAAAAAAAAAaAAUAAAAAAAAAAAAbAAUAAAAAAAAAAAAcAAUAAAAAAAAAAAAdAAUAAAAAAAAAAAAeAAUAAAAAAAAAAAAdAAYAAAAAAAAAAAAcAAYAAAAAAAAAAAAbAAYAAAAAAAAAAAAaAAYAAAAAAAAAAAABAAkAAAAAAAAAAAABAAoAAAAAAAAAAAACAAoAAAAAAAAAAAADAAoAAAAAAAAAAAAEAAoAAAAAAAAAAAAFAAoAAAAAAAAAAAD//wgAAAAAAAAAAAD+/wgAAAAAAAAAAAAJAA0AAAAAAAAAAAAKAA0AAAAAAAAAAAALAA0AAAAAAAAAAAAMAA0AAAAAAAAAAAANAA0AAAAAAAAAAAAOAA0AAAAAAAAAAAAPAA0AAAAAAAAAAAAQAA0AAAAAAAAAAAARAA0AAAAAAAAAAAASAA0AAAAAAAAAAAATAA0AAAAAAAAAAAAUAA0AAAAAAAAAAAAVAA0AAAAAAAAAAAA=")
tile_set = SubResource("TileSet_66pxm")

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2(125, 40)
zoom = Vector2(4, 4)

[node name="MultiplayerSpawner" type="MultiplayerSpawner" parent="."]
_spawnable_scenes = PackedStringArray("uid://cd4xuxqi1qlty")
spawn_path = NodePath("..")
